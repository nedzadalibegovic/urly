(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{115:function(e,t,a){e.exports=a(130)},129:function(e,t,a){},130:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),l=a(24),c=a.n(l),u=(a(120),a(50)),s=a(44),o=a(6),i=a.n(o),d=a(11),m=a(61),p=a(135),b=a(143),f=a(136),E=a(137),h=a(26),v=a(14),y=Object(n.createContext)(),x=function(e){var t=Object(n.useState)(""),a=Object(v.a)(t,2),l=a[0],c=a[1],u=Object(s.f)(),o=function(){var e=Object(d.a)(i.a.mark((function e(){var t,a,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://urly.lyra.nedzad.dev/token",{credentials:"include"});case 2:return t=e.sent,e.next=5,t.json();case 5:if(a=e.sent,n=a.accessToken,t.ok){e.next=9;break}return e.abrupt("return",u.push("/login"));case 9:c(n);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return r.a.createElement(y.Provider,{value:{token:l,setToken:c,renewToken:o}},e.children)},j=function(){var e=Object(n.useContext)(y).setToken,t=Object(s.f)(),a=h.a({username:h.b().required().min(4).max(20),password:h.b().required().min(8)}),l=function(){var a=Object(d.a)(i.a.mark((function a(n,r){var l,c,u,s,o,d;return i.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return l=n.username,c=n.password,u=r.setStatus,s=r.resetForm,a.next=4,fetch("https://urly.lyra.nedzad.dev/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:l,password:c})});case 4:return o=a.sent,a.next=7,o.json();case 7:d=a.sent,o.ok?(e(d.accessToken),t.push("/")):(s(),u(d.message));case 9:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}();return r.a.createElement(p.a,{className:"login-page"},r.a.createElement(m.a,{initialValues:{username:"",password:""},onSubmit:l,validationSchema:a,initialStatus:""},(function(e){var t=e.handleChange,a=e.handleSubmit,n=e.values,l=e.touched,c=e.errors,u=e.status;return r.a.createElement(b.a,{noValidate:!0,onSubmit:a},r.a.createElement(b.a.Group,null,r.a.createElement(b.a.Label,null,"Username"),r.a.createElement(b.a.Control,{id:"username",name:"username",type:"text",placeholder:"Username",value:n.username,onChange:t,isInvalid:l.username&&c.username}),r.a.createElement(b.a.Control.Feedback,{type:"invalid"},c.username)),r.a.createElement(b.a.Group,null,r.a.createElement(b.a.Label,null,"Password"),r.a.createElement(b.a.Control,{id:"password",name:"password",type:"password",placeholder:"Password",value:n.password,onChange:t,isInvalid:l.password&&c.password}),r.a.createElement(b.a.Control.Feedback,{type:"invalid"},c.password)),u&&r.a.createElement(f.a,{variant:"danger"},u),r.a.createElement(E.a,{variant:"primary",type:"submit"},"Submit"))})))},k=a(144),O=function(){var e=Object(n.useContext)(y),t=e.token,a=e.setToken,l=function(){var e=Object(d.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://urly.lyra.nedzad.dev/login",{method:"DELETE",credentials:"include"});case 2:a("");case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return r.a.createElement(p.a,null,r.a.createElement(k.a,null,r.a.createElement(k.a.Brand,null,r.a.createElement("h3",null,"Urly")),r.a.createElement(k.a.Toggle,null),r.a.createElement(k.a.Collapse,{className:"justify-content-end"},r.a.createElement(k.a.Text,null,t&&r.a.createElement(u.b,{to:{pathname:"/login"},onClick:l},"Log out")))))},w=a(140),g=a(110),S=a(141),C=a(112),T=Object(n.createContext)(),F=function(e){var t=Object(n.useContext)(y),a=t.token,l=t.renewToken,c=Object(n.useState)([]),u=Object(v.a)(c,2),s=u[0],o=u[1],m=function(){var e=Object(d.a)(i.a.mark((function e(){var t;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a){e.next=2;break}return e.abrupt("return",l());case 2:return e.next=4,fetch("https://urly.lyra.nedzad.dev/api",{headers:{Authorization:"Bearer ".concat(a)}});case 4:if((t=e.sent).ok){e.next=7;break}return e.abrupt("return",l());case 7:return e.t0=o,e.next=10,t.json();case 10:e.t1=e.sent,(0,e.t0)(e.t1);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),p=function(){var e=Object(d.a)(i.a.mark((function e(t){var n,r;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://urly.lyra.nedzad.dev/api",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify(t)});case 2:return n=e.sent,e.next=5,n.json();case 5:if(r=e.sent,!n.ok){e.next=11;break}return o([].concat(Object(C.a)(s),[r])),e.abrupt("return",r);case 11:if(403!==n.status){e.next=17;break}return e.next=14,l();case 14:throw new Error("Access token expired, please retry action");case 17:throw new Error(r.message);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),b=function(){var e=Object(d.a)(i.a.mark((function e(t){var n,r,c,u;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://urly.lyra.nedzad.dev/api"+"/".concat(t._id),{method:"PATCH",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(a)},body:JSON.stringify(t)});case 2:return n=e.sent,e.next=5,n.json();case 5:if(r=e.sent,!n.ok){e.next=13;break}c=s.slice(),u=c.findIndex((function(e){return e._id===r._id})),c[u]=r,o(c),e.next=20;break;case 13:if(403!==n.status){e.next=19;break}return e.next=16,l();case 16:throw new Error("Access token expired, please retry action");case 19:throw new Error(r.message);case 20:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),f=function(){var e=Object(d.a)(i.a.mark((function e(t){var n,r,c;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://urly.lyra.nedzad.dev/api"+"/".concat(t),{method:"DELETE",headers:{Authorization:"Bearer ".concat(a)}});case 2:if(!(n=e.sent).ok){e.next=8;break}r=s.filter((function(e){return t!==e._id})),o(r),e.next=18;break;case 8:if(403!==n.status){e.next=14;break}return e.next=11,l();case 11:throw new Error("Access token expired, please retry action");case 14:return e.next=16,n.json();case 16:throw c=e.sent,new Error(c.message);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(n.useEffect)((function(){m()}),[a]),r.a.createElement(T.Provider,{value:{urlies:s,addUrly:p,editUrly:b,deleteUrly:f}},e.children)},U=a(142),L=Object(n.createContext)(),P=function(e){var t=Object(n.useState)(!1),a=Object(v.a)(t,2),l=a[0],c=a[1],u=Object(n.useState)(""),s=Object(v.a)(u,2),o=s[0],i=s[1],d=Object(n.useState)(""),m=Object(v.a)(d,2),p=m[0],b=m[1],f=Object(n.useState)(""),E=Object(v.a)(f,2),h=E[0],y=E[1];return r.a.createElement(L.Provider,{value:{show:l,setShow:c,id:o,setId:i,title:p,setTitle:b,url:h,setUrl:y}},e.children)},z=function(){var e=Object(n.useContext)(L),t=e.id,a=e.show,l=e.setShow,c=e.title,u=e.url,s=Object(n.useContext)(T),o=s.editUrly,p=s.deleteUrly,v=Object(m.b)({initialValues:{title:c,url:u},onSubmit:function(){var e=Object(d.a)(i.a.mark((function e(a,n){var r,l;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.setStatus,e.prev=1,l={_id:t,title:a.title,url:a.url},e.next=5,o(l);case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(1),r(e.t0.message);case 10:case"end":return e.stop()}}),e,null,[[1,7]])})));return function(t,a){return e.apply(this,arguments)}}(),validationSchema:h.a({title:h.b().max(32).required("Cannot be empty"),url:h.b().url("Must be a valid URL").required()}),initialStatus:""}),y=function(){return l(!1)},x=function(){var e=Object(d.a)(i.a.mark((function e(){return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,p(t);case 3:y(),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),v.setStatus(e.t0.message);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(){return e.apply(this,arguments)}}();return Object(n.useEffect)((function(){v.resetForm()}),[a]),r.a.createElement(U.a,{show:a,onHide:y,backdrop:"static"},r.a.createElement(U.a.Header,{closeButton:!0},r.a.createElement(U.a.Title,null,c)),r.a.createElement(b.a,{noValidate:!0,onSubmit:v.handleSubmit},r.a.createElement(U.a.Body,null,r.a.createElement(b.a.Group,null,r.a.createElement(b.a.Label,null,"Title"),r.a.createElement(b.a.Control,Object.assign({type:"text"},v.getFieldProps("title"),{isInvalid:v.errors.title&&v.touched.title})),r.a.createElement(b.a.Control.Feedback,{type:"invalid"},v.errors.title)),r.a.createElement(b.a.Group,null,r.a.createElement(b.a.Label,null,"URL"),r.a.createElement(b.a.Control,Object.assign({type:"text"},v.getFieldProps("url"),{isInvalid:v.errors.url&&v.touched.url})),r.a.createElement(b.a.Control.Feedback,{type:"invalid"},v.errors.url)),v.status&&r.a.createElement(f.a,{variant:"danger"},v.status)),r.a.createElement(U.a.Footer,null,r.a.createElement(E.a,{variant:"danger",onClick:x},"Delete"),r.a.createElement(E.a,{variant:"primary",type:"submit"},"Save Changes"))))},N=a(145),B=a(138),A=function(){var e=Object(n.useContext)(T).addUrly,t=Object(n.useState)(!1),a=Object(v.a)(t,2),l=a[0],c=a[1],u=Object(n.useState)(1),s=Object(v.a)(u,2),o=s[0],p=s[1],y=Object(n.useState)(null),x=Object(v.a)(y,2),j=x[0],k=x[1],O=Object(n.useRef)(null),w=Object(m.b)({initialValues:{title:"",url:""},onSubmit:function(){var t=Object(d.a)(i.a.mark((function t(a){var n;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,p(3),t.next=4,e(a);case 4:n=t.sent,w.setStatus(""),k(n),O.current.innerText="Copy",O.current.type="button",O.current.onclick=navigator.clipboard.writeText("https://urly.lyra.nedzad.dev/"+n._id),t.next=16;break;case 12:t.prev=12,t.t0=t.catch(0),p(2),w.setStatus(t.t0.message);case 16:case"end":return t.stop()}}),t,null,[[0,12]])})));return function(e){return t.apply(this,arguments)}}(),validationSchema:h.a({title:h.b().max(32).required("Cannot be empty"),url:h.b().url("Must be a valid URL").required()}),initialStatus:"",validateOnMount:!0});return Object(n.useEffect)((function(){Object(d.a)(i.a.mark((function e(){var t,a,n;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(w.errors.url||""===w.values.url){e.next=13;break}return e.next=3,fetch("https://cors.nedzad.workers.dev/?"+w.values.url);case 3:if(!(t=e.sent).ok){e.next=13;break}return a=new DOMParser,e.t0=a,e.next=9,t.text();case 9:e.t1=e.sent,n=e.t0.parseFromString.call(e.t0,e.t1,"text/html"),w.values.title=n.querySelector("title").innerText,p(2);case 13:case"end":return e.stop()}}),e)})))()}),[w.values.url]),Object(n.useEffect)((function(){2===o&&(O.current.disabled=w.errors.title)}),[w.errors.title]),r.a.createElement(r.a.Fragment,null,r.a.createElement(E.a,{onClick:function(){p(1),c(!0),k(null),w.resetForm()}},"Shorten"),r.a.createElement(U.a,{show:l,onHide:function(){c(!1),w.resetForm()}},r.a.createElement(U.a.Header,{closeButton:!0},r.a.createElement(U.a.Title,null,"Shorten a URL")),r.a.createElement(b.a,{noValidate:!0,onSubmit:w.handleSubmit},r.a.createElement(U.a.Body,{className:"modal-body-center"},r.a.createElement(N.a.Container,{activeKey:o},r.a.createElement(N.a.Content,null,r.a.createElement(N.a.Pane,{eventKey:1},r.a.createElement(b.a.Group,null,r.a.createElement(b.a.Label,null,"URL"),r.a.createElement(b.a.Control,Object.assign({type:"text"},w.getFieldProps("url"),{isValid:!w.errors.url&&""!==w.values.url})))),r.a.createElement(N.a.Pane,{eventKey:2},r.a.createElement(b.a.Group,null,r.a.createElement(b.a.Label,null,"Title"),r.a.createElement(b.a.Control,Object.assign({type:"text"},w.getFieldProps("title"),{isValid:!w.errors.title,isInvalid:w.errors.title})),r.a.createElement(b.a.Control.Feedback,{type:"invalid"},w.errors.title))),r.a.createElement(N.a.Pane,{eventKey:3,style:{textAlign:"center"}},j?r.a.createElement("a",{href:"https://urly.lyra.nedzad.dev/"+j._id,className:"display-4",target:"blank"},"Open my Urly!"):r.a.createElement(B.a,{animation:"border",role:"status"},r.a.createElement("span",{className:"sr-only"},"Loading..."))))),w.status&&r.a.createElement(f.a,{variant:"danger"},w.status)),r.a.createElement(U.a.Footer,null,r.a.createElement(E.a,{ref:O,type:"submit",disabled:!0},"Shorten!")))))},I=a(146),R=a(139),_=function(e){var t=e.id,a=Object(n.useState)(!1),l=Object(v.a)(a,2),c=l[0],u=l[1],s=Object(n.useRef)(null),o=function(){var e=Object(d.a)(i.a.mark((function e(){var a;return i.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a="https://urly.lyra.nedzad.dev/"+t,e.next=3,navigator.clipboard.writeText(a);case 3:u(!0),setTimeout((function(){return u(!1)}),750);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return r.a.createElement(r.a.Fragment,null,r.a.createElement(E.a,{ref:s,style:{marginRight:"5px"},onClick:o},"Copy"),r.a.createElement(I.a,{target:s.current,show:c,placement:"bottom"},(function(e){return r.a.createElement(R.a,e,"Copied to clipboard!")})))},V=function(e){var t=e.id,a=e.title,l=e.url,c=Object(n.useContext)(L),u=c.setShow,s=c.setId,o=c.setTitle,i=c.setUrl;return r.a.createElement("tr",null,r.a.createElement("td",null,a),r.a.createElement("td",null,l),r.a.createElement("td",null,r.a.createElement("div",{className:"urlies-button"},r.a.createElement(_,{id:t}),r.a.createElement(E.a,{onClick:function(){s(t),o(a),i(l),u(!0)}},"Edit"))))},q=function(){var e=Object(n.useContext)(T).urlies;return r.a.createElement(p.a,{className:"urlies-list"},r.a.createElement(z,null),r.a.createElement(w.a,null,r.a.createElement(g.a,null,r.a.createElement("p",null,"You have shortened ",e.length," links in total")),r.a.createElement(g.a,null,r.a.createElement("div",{className:"urlies-button"},r.a.createElement(A,null)))),r.a.createElement(w.a,{style:{paddingTop:"10px"}},r.a.createElement(S.a,null,r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",null,"Title"),r.a.createElement("th",null,"URL"),r.a.createElement("th",null))),r.a.createElement("tbody",null,e.map((function(e){return r.a.createElement(V,{id:e._id,title:e.title,url:e.url,key:e._id})}))))))};var G=function(){return r.a.createElement(u.a,null,r.a.createElement(x,null,r.a.createElement(F,null,r.a.createElement(O,null),r.a.createElement(s.c,null,r.a.createElement(s.a,{component:j,path:"/login",exact:!0}),r.a.createElement(P,null,r.a.createElement(s.a,{component:q,path:"/",exact:!0}))))))};a(129);c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(G,null)),document.getElementById("root"))}},[[115,1,2]]]);
//# sourceMappingURL=main.6bf34984.chunk.js.map